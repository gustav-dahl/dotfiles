# ==============================================================================
# TMUX CONFIGURATION FILE
# ==============================================================================
# This configuration provides a modern tmux setup with vim-style keybindings,
# session persistence, and the Ayu theme.
#
# Prefix Key: Ctrl+Space (instead of default Ctrl+b)
# 
# Quick Reference:
#   Prefix + r     - Reload this config
#   Prefix + -     - Split pane horizontally
#   Prefix + _     - Split pane vertically
#   Prefix + h/j/k/l - Resize panes (vim-style)
#   Prefix + m     - Maximize/minimize pane
#   Prefix + s     - Session selector
#   Prefix + [     - Enter copy mode (vim keys work here)
#   Prefix + P     - Paste copied text
#
# For full documentation, see README.md
# ==============================================================================

# ------------------------------------------------------------------------------
# SHELL CONFIGURATION
# ------------------------------------------------------------------------------
# Use zsh as the default shell for new tmux windows/panes
set -g default-shell /bin/zsh

# ------------------------------------------------------------------------------
# TERMINAL & COLOR SETTINGS
# ------------------------------------------------------------------------------
# Enable 256-color and true-color (24-bit) support in tmux
# This is essential for modern terminal applications and themes
set -g default-terminal "screen-256color"     # Set terminal type for 256-color support
set -ga terminal-overrides ",*256col*:Tc"     # Override to enable true-color for compatible terminals

# ------------------------------------------------------------------------------
# GENERAL SETTINGS
# ------------------------------------------------------------------------------
set -g set-clipboard on         # Use system clipboard for copy/paste
set -g detach-on-destroy off    # Don't exit tmux when closing a session (switch to another)
set -g escape-time 0            # Remove delay for ESC key (important for Neovim/Vim users)
set -g history-limit 1000000    # Increase scrollback history (default: 2,000 lines)
set -g mouse on                 # Enable mouse support (click, scroll, resize panes)
set -g status-interval 3        # Update status bar every 3 seconds (default: 15)
set -g allow-passthrough on     # Allow programs to bypass tmux (needed for image previews)

# Place the status bar at the bottom of the screen
set-option -g status-position bottom

# ------------------------------------------------------------------------------
# PREFIX KEY CONFIGURATION
# ------------------------------------------------------------------------------
# Change prefix from Ctrl+b to Ctrl+Space (easier to reach)
# NOTE: macOS users should disable Ctrl+Space for input source switching
#       in System Settings > Keyboard > Keyboard Shortcuts > Input Sources
unbind C-b                      # Unbind the default prefix key
set -g prefix C-Space           # Set new prefix key to Ctrl+Space

# ------------------------------------------------------------------------------
# KEY BINDINGS - GENERAL
# ------------------------------------------------------------------------------
# Reload tmux configuration with Prefix + r
unbind r
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded!"

# ------------------------------------------------------------------------------
# KEY BINDINGS - PANE SPLITTING
# ------------------------------------------------------------------------------
# Split panes using more intuitive keys
# Prefix + - : Split horizontally (panes side by side)
# Prefix + _ : Split vertically (panes stacked)
unbind %
bind - split-window -h          # Horizontal split (side by side)

unbind '"'
bind _ split-window -v          # Vertical split (stacked)

# ------------------------------------------------------------------------------
# KEY BINDINGS - SESSION & WINDOW MANAGEMENT
# ------------------------------------------------------------------------------
# Show sessions selector using Prefix + s (with zoom for better visibility)
bind s choose-session -Z

# Create new window in the current working directory
bind c new-window -c "#{pane_current_path}"

# ------------------------------------------------------------------------------
# KEY BINDINGS - PANE RESIZING (VIM-STYLE)
# ------------------------------------------------------------------------------
# Use vim-style hjkl keys to resize panes
# The -r flag allows repeating without pressing prefix again
bind -r j resize-pane -D 5      # Resize down
bind -r k resize-pane -U 5      # Resize up
bind -r l resize-pane -R 5      # Resize right
bind -r h resize-pane -L 5      # Resize left

# Maximize/minimize current pane with Prefix + m
bind -r m resize-pane -Z

# ------------------------------------------------------------------------------
# COPY MODE (VIM-STYLE)
# ------------------------------------------------------------------------------
# Enable vi mode for copy mode navigation
# Enter copy mode with Prefix + [, then use vim keys to navigate
set-window-option -g mode-keys vi

# In copy mode:
#   v - Start selection (like vim visual mode)
#   y - Copy selection to system clipboard
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind -T copy-mode-vi 'y' send-keys -X copy-pipe-and-cancel "pbcopy"

# Paste yanked text with Prefix + P (uppercase)
# Note: Prefix + p (lowercase) goes to previous window
bind P paste-buffer

# Don't exit copy mode when dragging with mouse (allows multiple selections)
unbind -T copy-mode-vi MouseDragEnd1Pane

# ------------------------------------------------------------------------------
# WINDOW & PANE INDEXING
# ------------------------------------------------------------------------------
# Start windows and panes at 1 instead of 0 (easier to reach on keyboard)
set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on      # Automatically renumber windows when one is closed

# ==============================================================================
# PLUGINS (managed by TPM - Tmux Plugin Manager)
# ==============================================================================
# Install plugins with: Prefix + I (capital I)
# Update plugins with:  Prefix + U
# ------------------------------------------------------------------------------

# TPM - Tmux Plugin Manager (required for other plugins)
set -g @plugin 'tmux-plugins/tpm'

# ------------------------------------------------------------------------------
# Navigation Plugin
# ------------------------------------------------------------------------------
# vim-tmux-navigator: Seamless navigation between tmux panes and vim splits
# Use Ctrl+h/j/k/l to move between panes (works in both tmux and Neovim)
set -g @plugin 'christoomey/vim-tmux-navigator'

# ------------------------------------------------------------------------------
# Session Persistence Plugins
# ------------------------------------------------------------------------------
# tmux-resurrect: Save and restore tmux sessions manually
# - Prefix + Ctrl+s to save
# - Prefix + Ctrl+r to restore
set -g @plugin 'tmux-plugins/tmux-resurrect'

# tmux-continuum: Automatic session saving (every 15 minutes)
# Sessions are automatically restored when tmux starts
set -g @plugin 'tmux-plugins/tmux-continuum'

# ------------------------------------------------------------------------------
# Theme Plugin
# ------------------------------------------------------------------------------
# Ayu theme - A beautiful dark theme
set -g @plugin 'TechnicalDC/tmux-ayu-theme'

# Optional: CPU and memory monitor (currently disabled)
#set -g @plugin 'hendrikmi/tmux-cpu-mem-monitor'

# Optional: Alternative themes (currently disabled)
#if-shell "[[ \"$TMUX_THEME\" == \"onedark\" ]]" 'source-file ~/.config/tmux/onedark-theme.conf' ""
#if-shell "[[ \"$TMUX_THEME\" == \"nord\" ]]" 'source-file ~/.config/tmux/nord-theme.conf' ""

# ==============================================================================
# THEME CUSTOMIZATION
# ==============================================================================
# Ayu theme settings (must be set BEFORE the theme loads via TPM)
# Remove hostname widget from status bar (shows empty space instead)
# To restore default appearance, comment out the line below
set -g @ayu_widgets " "

# ==============================================================================
# PLUGIN SETTINGS
# ==============================================================================
# Resurrect: Capture and restore pane contents
set -g @resurrect-capture-pane-contents 'on'

# Continuum: Automatically restore last saved session on tmux start
set -g @continuum-restore 'on'

# ==============================================================================
# INITIALIZE TPM
# ==============================================================================
# IMPORTANT: This line MUST be at the very end of the plugin section
# It loads all plugins defined above
run '~/.tmux/plugins/tpm/tpm'

# ==============================================================================
# POST-THEME CUSTOMIZATIONS
# ==============================================================================
# These settings MUST come AFTER TPM initialization to override theme defaults

# Custom status bar right side (removes hostname, shows only time and date)
# To restore default with hostname, comment out the line below
set -g status-right "#[fg=#CBCCC6,bg=#101521,nounderscore,noitalics]  %R    %Y-%m-%d "

# ==============================================================================
# TROUBLESHOOTING NOTES
# ==============================================================================
# - To apply theme changes: tmux kill-server && rm -rf /tmp/tmux-*
# - macOS: Disable Ctrl+Space for input source switching in:
#   System Settings > Keyboard > Keyboard Shortcuts > Input Sources
# ==============================================================================
